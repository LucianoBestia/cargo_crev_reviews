<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="cargo_crev_reviews"><meta name="keywords" content="rust, rustlang, rust-lang, cargo_crev_reviews"><title>cargo_crev_reviews - Rust</title><link rel="stylesheet" type="text/css" href="../normalize.css"><link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../light.css"  id="themeStyle"><link rel="stylesheet" type="text/css" href="../dark.css" disabled ><link rel="stylesheet" type="text/css" href="../ayu.css" disabled ><script id="default-settings" ></script><script src="../storage.js"></script><script src="../crates.js"></script><noscript><link rel="stylesheet" href="../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../favicon.svg"><style type="text/css">#crate-search{background-image:url("../down-arrow.svg");}</style></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu" role="button">&#9776;</div><a href='../cargo_crev_reviews/index.html'><div class='logo-container rust-logo'><img src='../rust-logo.png' alt='logo'></div></a><h2 class="location">Crate cargo_crev_reviews</h2><div class="block version"><div class="narrow-helper"></div><p>Version 2021.1215.1209</p></div><div class="sidebar-elems"><a id="all-types" href="all.html"><p>See all cargo_crev_reviews's items</p></a><div class="block items"><ul><li><a href="#modules">Modules</a></li><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#functions">Functions</a></li></ul></div><div id="sidebar-vars" data-name="cargo_crev_reviews" data-ty="mod" data-relpath=""></div><script defer src="sidebar-items.js"></script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu" title="themes"><img width="18" height="18" alt="Pick another theme!" src="../brush.svg"></button><div id="theme-choices" role="menu"></div></div><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><button type="button" id="help-button" title="help">?</button><a id="settings-menu" href="../settings.html" title="settings"><img width="18" height="18" alt="Change settings" src="../wheel.svg"></a></div></form></nav><section id="main" class="content"><h1 class="fqn"><span class="in-band">Crate <a class="mod" href="#">cargo_crev_reviews</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span><span class="out-of-band"><span id="render-detail"><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span><a class="srclink" href="../src/cargo_crev_reviews/lib.rs.html#4-549" title="goto source code">[src]</a></span></h1><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><h2 id="cargo_crev_reviews" class="section-header"><a href="#cargo_crev_reviews">cargo_crev_reviews</a></h2>
<p><strong>Write cargo-crev reviews in GUI with a cross-platform app written in full-stack rust</strong><br />
<em><strong><a href="https://github.com/lucianobestia/cargo_crev_reviews_workspace">repository</a>; version: 2021.1215.1209  date: 2021-12-15 authors: Luciano Bestia</strong></em></p>
<p><a href="https://github.com/LucianoBestia/cargo_crev_reviews_workspace/"><img src="https://img.shields.io/badge/Lines_in_Rust-2084-green.svg" alt="Lines in Rust code" /></a>
<a href="https://github.com/LucianoBestia/cargo_crev_reviews_workspace/"><img src="https://img.shields.io/badge/Lines_in_Doc_comments-479-blue.svg" alt="Lines in Doc comments" /></a>
<a href="https://github.com/LucianoBestia/cargo_crev_reviews_workspace/"><img src="https://img.shields.io/badge/Lines_in_comments-182-purple.svg" alt="Lines in Comments" /></a>
<a href="https://github.com/LucianoBestia/cargo_crev_reviews_workspace/"><img src="https://img.shields.io/badge/Lines_in_examples-0-yellow.svg" alt="Lines in examples" /></a>
<a href="https://github.com/LucianoBestia/cargo_crev_reviews_workspace/"><img src="https://img.shields.io/badge/Lines_in_tests-16-orange.svg" alt="Lines in tests" /></a></p>
<p><a href="https://crates.io/crates/cargo_crev_reviews"><img src="https://img.shields.io/crates/v/cargo_crev_reviews.svg" alt="crates.io" /></a> <a href="https://docs.rs/cargo_crev_reviews/"><img src="https://docs.rs/cargo_crev_reviews/badge.svg" alt="Documentation" /></a> <a href="https://web.crev.dev/rust-reviews/crate/cargo_crev_reviews/"><img src="https://web.crev.dev/rust-reviews/badge/crev_count/cargo_crev_reviews.svg" alt="crev reviews" /></a> <a href="https://lib.rs/crates/cargo_crev_reviews/"><img src="https://img.shields.io/badge/Lib.rs-rust-orange.svg" alt="Lib.rs" /></a> <a href="https://github.com/LucianoBestia/cargo_crev_reviews/blob/master/LICENSE"><img src="https://img.shields.io/badge/license-MIT-blue.svg" alt="License" /></a> <a href="https://github.com/LucianoBestia/cargo_crev_reviews/actions"><img src="https://github.com/LucianoBestia/cargo_crev_reviews/workflows/RustAction/badge.svg" alt="Rust" /></a></p>
<h3 id="try-it" class="section-header"><a href="#try-it">Try it</a></h3>
<p>Install cargo_crev_reviews:</p>
<div class="example-wrap"><pre class="language-bash"><code>cargo install cargo_crev_reviews</code></pre></div>
<p>Go to a Rust project directory where the Cargo.toml file is, and start the program:</p>
<div class="example-wrap"><pre class="language-bash"><code>cd ~/rustprojects/your-project-name
cargo_crev_reviews</code></pre></div>
<p>And follow the simple instructions…</p>
<p>Backend CLI in Linux terminal:<br />
<img src="https://github.com/LucianoBestia/cargo_crev_reviews_workspace/raw/main/images/screen_5.png" alt="screen_5" title="screen_5" /><br />
Frontend GUI in browser:<br />
<img src="https://github.com/LucianoBestia/cargo_crev_reviews_workspace/raw/main/images/screen_6.png" alt="screen_6" title="screen_6" /></p>
<h3 id="cargo-tree" class="section-header"><a href="#cargo-tree">cargo tree</a></h3>
<p>Cargo-tree is a Rust utility that shows all the ramification of dependencies in your Rust project.</p>
<h3 id="your-personal-reviews" class="section-header"><a href="#your-personal-reviews">your personal reviews</a></h3>
<p>Your personal reviews are the most important. Ideally, you want to personally review every crate, rate it and write something about it for your own use. You want to know that the dependencies your program is using are not malicious or unsound. If you have a boss, he will sooner or later ask you if you reviewed all the dependencies. With <code>cargo_crev_reviews</code> you have a basic tool to do that.</p>
<p>Don’t panic!</p>
<p>To write a review you need to see the exact source code and other metadata about the crate. Click on the crate name in the list and it will open:</p>
<ul>
<li>VSCode with the exact source code</li>
<li><a href="https://web.crev.dev/rust-reviews/crates/">crev.dev</a> for other people reviews</li>
<li>crates.io for basic information</li>
<li>lib.rs for extended information</li>
<li>a list of all versions of that crate with your reviews added</li>
</ul>
<p>Be warned that modern browsers block pop-ups and you have to allow that explicitly for this site <code>127.0.0.1</code>.</p>
<h3 id="reputation-vs-code-review" class="section-header"><a href="#reputation-vs-code-review">Reputation vs. code review</a></h3>
<p>Personally, I think that the reputation of the author is important. For some highly visible and respected members of the Rust community I don’t review the code. The reputation of the author is enough to make me feel safe. This method is not perfect, because there can be identity theft or a faulty version. But I still think that it is an efficient and effective method for me.<br />
Crates.io made a confusion with authors and owners. Lately they introduced the <code>published_by</code> field for every published version. For me this is the main person responsible for any eventual issue of this specific published version. Crates.io guarantees that published versions cannot be modified later. They are read-only, so you know that you see exactly the right code.</p>
<h3 id="share-it-with-the-community" class="section-header"><a href="#share-it-with-the-community">Share it with the community</a></h3>
<p>When you are satisfied with your own reviews, you then publish them for other developers to read. In the same way, reviews from other developers help you when analyzing the dependencies. More people that write reviews, better the information we get for our decisions.<br />
One crate can have many versions. Every version is separately reviewed. Often, the review will be just the same for many versions, but that is good. When a developer wants to see the reviews for a specific version, he does not need to watch the reviews of all other versions of the same crate.</p>
<h3 id="tldr" class="section-header"><a href="#tldr">TL;DR</a></h3>
<p>For developers that want to understand, tweak the code and contribute to the project, below is a long description of the important aspects of the project. If you are only a user of <code>cargo_crev_reviews</code>, you don’t need to read all of this.</p>
<h3 id="motivation" class="section-header"><a href="#motivation">Motivation</a></h3>
<p>I think <a href="https://lib.rs/crates/cargo-crev">cargo-crev</a> is a great tool to express trustworthiness in the open-source community, especially for the <a href="https://www.rust-lang.org/">Rust programming language</a>.  I fear so much of <a href="https://en.wikipedia.org/wiki/Supply_chain_attack">supply chain attacks</a> using dependencies from <a href="https://crates.io/">crates.io</a>. For the smallest project you can get 100 dependencies easily. How to trust them all? To review them all manually? It is just crazy.<br />
But if enough people write reviews, it will be so much easier to trust the code. It is the same principle as <a href="https://www.booking.com/">booking.com</a> or <a href="https://www.airbnb.com/">air-bnb</a>. Guests of a hotel write a review about their actual experience in the hotel. And you can read a hopefully truthful review and can understand if the hotel is good or bad. Sometimes can happen to find a fake review, but if there is enough people, most of them will be sincere.<br />
Sadly, writing reviews in <code>cargo-crev</code> is hard. Let’s make a <a href="https://en.wikipedia.org/wiki/Graphical_user_interface">GUI</a> wrapper around <code>cargo-crev</code> to make write reviews easier.<br />
We will see walking the path what obstacles we must overcome.</p>
<h3 id="technical-decisions" class="section-header"><a href="#technical-decisions">Technical decisions</a></h3>
<p>Rust does not have a true GUI story. It is mostly for <a href="https://en.wikipedia.org/wiki/Command-line_interface">CLI</a> and libraries. Because GUI is mostly non cross-platform. But Rust is the best language for <a href="https://webassembly.org/">Wasm/Webassembly</a>. So let’s combine this.<br />
I will make a Rust <a href="https://doc.rust-lang.org/book/ch14-03-cargo-workspaces.html">workspace</a> (multi-projects):</p>
<ol>
<li>CLI for a web server (local micro-server)</li>
<li>Wasm for the browser (chrome and similar)</li>
</ol>
<p>The web server CLI will access files, commands, libraries and the network. This will work only in <a href="https://en.wikipedia.org/wiki/Linux">Linux</a>, but today Win10 has integrated Linux with <a href="https://en.wikipedia.org/wiki/Windows_Subsystem_for_Linux">WSL2</a>. It will work just fine on all the operating systems sensible for Rust development.<br />
Wasm in browser will just access the local micro web server. This is gonna be the GUI and because the browser works in every <a href="https://en.wikipedia.org/wiki/Operating_system">OS</a>, this is <a href="https://en.wikipedia.org/wiki/Cross-platform_software">cross-platform</a> development.</p>
<p>I want the simplest <a href="https://en.wikipedia.org/wiki/Web_server">web server</a> ever. It will be used exclusively locally from one super simple <a href="https://en.wikipedia.org/wiki/Web_application">web-application</a>, so  don’t need to care much about security. I choose <a href="https://crates.io/crates/simple-server">simple server</a> from the <a href="https://doc.rust-lang.org/1.30.0/book/second-edition/ch20-01-single-threaded.html">Rust book</a>. I don’t care about <a href="https://en.wikipedia.org/wiki/Multithreading_(computer_architecture)">multi-threading</a> or <a href="https://en.wikipedia.org/wiki/Asynchrony_(computer_programming)">async</a> , because it will be used by only one browser. The example from the book evolved into the github repository of the author of the book <a href="https://github.com/steveklabnik/simple-server">github.com/steveklabnik</a>. I cloned it and update the dependencies and consequently fixed some broken code. I published it as dev_bestia_simple_server on crates.io.</p>
<p>For the browser I will create a simple web app. All the code will be in Rust, I will avoid javascript. The GUI will be in <a href="https://en.wikipedia.org/wiki/HTML5">HTML5</a> and <a href="https://en.wikipedia.org/wiki/CSS#CSS_3">CSS3</a>. This is all supported by all <a href="https://www.bopdesign.com/bop-blog/2012/01/why-use-a-modern-web-browser/">modern browsers</a>.</p>
<h3 id="development" class="section-header"><a href="#development">Development</a></h3>
<p>I will use <a href="https://crates.io/crates/cargo-auto">cargo-auto</a> to automate the tasks needed to build the project.<br />
The sub-directory <code>automation_tasks_rs</code> is the Rust project for <a href="https://crates.io/crates/cargo-auto">cargo-auto</a>.</p>
<p>The Rust workspace is made of members:</p>
<ul>
<li>backend CLI (this will be the main and only project to be published on crates.io)</li>
<li>GUI frontend</li>
</ul>
<p>The sub-directory <code>web_server_folder</code> contains all the files and folder structure for a working development web_server.<br />
But this files are not used directly. Because of the way the publish to crates.io works, I will embed them inside the Rust code as strings (base64 encoded if needed). I will make an automation task for that.</p>
<p>There is a file <code>auto_generated_mod.rs</code> where automation tasks generates boilerplate code. I prefer generated code to <code>procedural macros</code> because it is easy to write(generate), read and debug the code. Also the tools for auto-completion can have problems with procedural macros.</p>
<h3 id="backend---cargo_crev_reviews" class="section-header"><a href="#backend---cargo_crev_reviews">backend - cargo_crev_reviews</a></h3>
<p>This is a micro-web-server intended for local use with only one local browser connected to it.<br />
It is the backend of the application <code>cargo_crev_reviews</code>. I had to use the same name here.<br />
Together the backend and the frontend form a complete application that is cross-platform.<br />
They share some structs for communication that are defined in the <code>common_structs_mod</code> module. One automation task copies the content from backend to frontend projects to keep them in sync.<br />
The only URL the server operates is: <a href="http://127.0.0.1:8182/cargo_crev_reviews">http://127.0.0.1:8182/cargo_crev_reviews</a></p>
<p>If I want to publish this on crates.io it must all be inside one binary executable file.<br />
It means that all the static files: css, html, icons, images, … must be inside the Rust code.<br />
For developing it is practical to have all this files as files.<br />
But before release an automation task converts this files to strings and put them into the Rust code.</p>
<p>The micro-server will accept mostly <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/POST">POST</a> with json similar to  <a href="https://www.jsonrpc.org/specification">json-rpc</a>. But sure I had to modify it to something more adequate for my use-case. I think in the future I will change that even more to something even more adequate.</p>
<div class="example-wrap"><pre class="language-bash"><code>Syntax:

--&gt; data sent to Server - request
&lt;-- data sent to Client - response

rpc call with named parameters:

--&gt; {
&quot;request_method&quot;: &quot;subtract_calculate&quot;, 
&quot;request_data&quot;: {
    &quot;subtrahend&quot;: 23, 
    &quot;minuend&quot;: 42, 
    }
}

&lt;-- {
&quot;response_method&quot;: &quot;subtract_show&quot;, 
&quot;response_data&quot;: {
    &quot;subtracted&quot;: 19,     
    },
&quot;response_html&quot;:&quot;...&quot;    
}</code></pre></div>
<p>An example how to test a POST request with curl:</p>
<div class="example-wrap"><pre class="language-bash"><code>curl -d &#39;{&quot;request_method&quot;: &quot;subtract&quot;, &quot;request_data&quot;: {&quot;subtrahend&quot;: 23, &quot;minuend&quot;: 42}}&#39; -H &#39;Content-Type: application/json&#39; http://127.0.0.1:8182/cargo_crev_reviews</code></pre></div>
<p>There are also a small number of GET requests for static files mostly to start the communication between the browser and the server.</p>
<h3 id="gui-frontend---cargo_crev_reviews_wasm" class="section-header"><a href="#gui-frontend---cargo_crev_reviews_wasm">GUI frontend - cargo_crev_reviews_wasm</a></h3>
<p>This simple web app is the GUI frontend of the application <code>cargo_crev_reviews</code>.<br />
It is strictly designed for use on desktops as it is a tool for programers. No need to do a mobile version. The response from the rpc server contains:</p>
<ol>
<li>response method name</li>
<li>html template</li>
<li>data</li>
</ol>
<p>The method name is used to match and call the appropriate function.<br />
The html template must be microXml compatible. The wasm code reads element by element and when finds a marker, inserts the data. I wanted the html template to be complete with some sample texts. So the markers are added in front of the element or attribute they are meant to replace.</p>
<h3 id="common-structs---common_structs_modrs" class="section-header"><a href="#common-structs---common_structs_modrs">common structs - common_structs_mod.rs</a></h3>
<p>Common structures between backend and frontend. It is kind of a contract for communication.<br />
All in 100% Rust language. One automation task keeps in sync the backend and frontend module.<br />
TODO: Using structs is not generic enough. Most of the time I need then name of a field. Because with the name I can bind in different scenarios. Using structs I don’t have the name of the field at runtime. I think I will ditch most of the structs to have just a plain old flat text with QVS21. Inside that text every field will have a slice and a name. And I can then use that in runtime for bindings.</p>
<h3 id="cargo-crev-integration" class="section-header"><a href="#cargo-crev-integration">cargo-crev integration</a></h3>
<p>The <a href="https://github.com/crev-dev/cargo-crev">cargo-crev</a> project contains many crates. The crates <code>crev-lib</code> and <code>crev-data</code> are libraries for integration. All the code working with crev is encapsulated in the crev_mod.rs module.</p>
<h3 id="cargo-registry" class="section-header"><a href="#cargo-registry">cargo registry</a></h3>
<p>The cargo application is essential for work with the Rust language. It maintains a local <code>cargo registry cache</code>. The registry index is git fetched from github. Path to an index file:<br />
<code>~/.cargo/registry/index/github.com-1ecc6299db9ec823/cache/re/ad/reader_for_microxml</code></p>
<div class="example-wrap"><pre class="language-bash"><code>cd ~/.cargo/registry/index/github.com-1ecc6299db9ec823
git remote add origin https://github.com/rust-lang/crates.io-index
git pull
rmdir ~/.cargo/registry/index/github.com-1ecc6299db9ec823
cd ~/.cargo/registry/index
git clone https://github.com/rust-lang/crates.io-index github.com-1ecc6299db9ec823
</code></pre></div>
<p>The content of this file is roughly:</p>
<div class="example-wrap"><pre class="language-yaml"><code>bc688d353fc7c7a2f3f1f5fed9a27fc1773fc710
1.0.0 {
    &quot;name&quot;: &quot;reader_for_microxml&quot;,
    &quot;vers&quot;: &quot;1.0.0&quot;,
    &quot;deps&quot;: [],
    &quot;cksum&quot;: &quot;623616f68a6441e2f61aa01c9bbcf76f4c9989328e0e10ab747e936718791912&quot;,
    &quot;features&quot;: {},
    &quot;yanked&quot;: true,
    &quot;links&quot;: null
}
1.1.11 {
    &quot;name&quot;: &quot;reader_for_microxml&quot;,
    &quot;vers&quot;: &quot;1.1.11&quot;,
    &quot;deps&quot;: [],
    &quot;cksum&quot;: &quot;fd50abb1f0d11a59ebe6d3f31446e4af8d0f8a7df668034b6c9b94453fa30c42&quot;,
    &quot;features&quot;: {},
    &quot;yanked&quot;: true,
    &quot;links&quot;: null
}</code></pre></div>
<p>Cargo also downloads from crates.io the complete source code for every dependency in the path <code>~/.cargo/registry/src/github.com-1ecc6299db9ec823/</code>. <code>Crates.io</code> guarantees the source code for a crate+version cannot be altered or deleted. We know it will never change, so we can review exactly this local code with confidence.</p>
<h3 id="cratesio-api" class="section-header"><a href="#cratesio-api">crates.io API</a></h3>
<p>Some data are not available locally in the cargo registry and need to be obtained from <a href="https://crates.io//api/v1/crates/%7B%7D/%7B%7D/">https://crates.io//api/v1/crates/{}/{}/</a>. Then I store them in <code>~/.config/crev/cargo_crev_reviews_data/db</code>. Data from crates.io are immutable all, except yanked. I will find in the local registry the data for yanked and new versions. That will trigger the download of data from crates.io.</p>
<h3 id="trusted-publishers" class="section-header"><a href="#trusted-publishers">trusted publishers</a></h3>
<p>There is a confusion on crates.io who is the owner, author or group that is responsible for a crate version. Lately they added a <code>published_by</code> field for a crate_version. That sounds more accurate. In the file <code>~/.config/crev/cargo_crev_reviews_data/trusted_publishers.json</code> is the list of your trusted publishers. You can edit this file manually.</p>
<h3 id="code-flow" class="section-header"><a href="#code-flow">Code-flow</a></h3>
<p>Everything is compiled into one single executable binary for Linux: <code>cargo_crev_reviews</code>.<br />
First it opens the default browser with <code>xdg-open</code> on <a href="http://127.0.0.1:8182/cargo_crev_reviews/index.html">http://127.0.0.1:8182/cargo_crev_reviews/index.html</a>.<br />
I received a comment that <code>xdg-open</code> is not preinstalled on every Linux distro. I use Debian 10 and have it.<br />
On other distros it is possible to install it with <code>xdg-utils</code>.<br />
If your WSL2 does not have yet a default browser run this:</p>
<div class="example-wrap"><pre class="language-bash"><code>ln -s &quot;/mnt/c/Program Files/Mozilla Firefox/firefox.exe&quot; /usr/bin/browser_in_win
export BROWSER=&#39;/usr/bin/browser_in_win&#39;</code></pre></div>
<p>The command <code>ln -sf</code> is permanent and persistent. It makes a symbolic link file that stays there forever. But <code>export BROWSER=</code> is NOT persistent. You need to add this command to <code>~/.bashrc</code> that runs it on every start of terminal.</p>
<p>In the next millisecond the web server starts listening to 127.0.0.1 port 8182.<br />
The first set of requests are GET and response is “static” files embedded in auto_generated_files_mod.rs</p>
<ol>
<li>browser request for <code>/cargo_crev_reviews/index.html</code> is GET, the response is html text file embedded in auto_generated_files_mod.rs in the function: <code>index_html()</code><br />
This html is just an empty shell that gets the css and wasm code. There is no real content inside. This concept is <a href="https://en.wikipedia.org/wiki/Single-page_application">Single-page application SPA</a>.</li>
<li>index.html requests: 3 css files, <code>pkg/cargo_crev_reviews.js</code>, <code>pkg/cargo_crev_reviews_bg.wasm</code>, “favicon” <code>icons/icon-032.png</code>. All these requests are GET and responses come from auto_generated_files_mod.rs functions, some are text files and others are base64 files.</li>
<li>the browser imports the wasm module and starts the init function that requests <code>srv_review_list</code>. This responds with: response_method_name, response_html and response_data.</li>
<li>wasm (inside the browser) is Rust code. First it matches method_name and calls the appropriate function. It processes the html with the data and inserts it into index.html (the empty shell).</li>
<li>the browser renders our first page. Hooray!</li>
<li>the user clicks on some button.</li>
<li>the macro <code>on_click!</code> or <code>row_on_click!</code> hides the ugly Rust code behind the definition of an event handler in web_sys and calls a function</li>
<li>wasm creates a rpc request and sends/POST to the server</li>
<li>the request is POST, the server first matches the method_name and calls the appropriate function. The function processes the call and prepares some data. It loads the html template.</li>
<li>The response contains the html to be rendered and data to be inserted in this html before rendering.</li>
</ol>
<h3 id="how-to-add-a-page-with-data" class="section-header"><a href="#how-to-add-a-page-with-data">How to add a page with data</a></h3><h4 id="define-the-data-structs" class="section-header"><a href="#define-the-data-structs">Define the data structs</a></h4>
<p>In <code>common_structs_mod.rs</code> add the structs like:</p>
<div class="example-wrap"><pre class="language-bash"><code>#[derive(Serialize, Deserialize, Debug, Default)]
pub struct VersionItemData {
    pub crate_name: String,
    pub crate_version: String,
}

#[derive(Serialize, Deserialize, Debug, Default)]
pub struct VersionListData {
    pub list_of_version: Vec&lt;VersionItemData&gt;,
}</code></pre></div><h4 id="create-a-standard-html-page" class="section-header"><a href="#create-a-standard-html-page">Create a “standard” html page</a></h4>
<p>The html page has to be MicroXml compatible, basically XHtml.  Copy for example <code>web_server_folder/review_list.html</code> to a new html file. Open this file with a browser to preview it. I use the VSCode extension <a href="https://marketplace.visualstudio.com/items?itemName=NoThlnG.vscode-open-wsl">vscode-open-wsl</a> and right-click on the file and <code>Open with default application</code>. In WSL2 I use my project <a href="https://github.com/LucianoBestia/wsl_open_browser">wsl_open_browser</a>. Now edit the html file to your liking and reload the browser with F5 to see the changes. Use some sample text to make it look as close to what you want. These texts will be later programmatically replaced, but they are invaluable while designing a nice layout.</p>
<h4 id="add-markers" class="section-header"><a href="#add-markers">Add markers</a></h4>
<p>Inside the html you want to replace the sample texts with the data from the server. Before the text add the (invisible) marker for example <code>&lt;!--wt_crate_name--&gt;</code>. You can replace also an attribute if you insert an attribute before it like this <code>data-wt_variable_name=&quot;next_attribute_name&quot;</code>.<br />
Now run the automation task <code>cargo auto build</code> that will copy/embed this file into <code>auto_generated_files_mod.rs</code>.</p>
<h4 id="write-a-server-functions" class="section-header"><a href="#write-a-server-functions">Write a server functions</a></h4>
<p>In <code>srv_methods_mod.rs</code> add a function like this:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="attribute">#[<span class="ident">named</span>]</span>
<span class="kw">pub</span> <span class="kw">fn</span> <span class="ident">srv_function_name</span>(<span class="ident">request_data</span>: <span class="ident">serde_json::Value</span>) -&gt; <span class="ident">anyhow::Result</span><span class="op">&lt;</span><span class="ident">String</span><span class="op">&gt;</span> {
    <span class="macro">log::info!</span>(<span class="macro">function_name!</span>());
    <span class="kw">let</span> <span class="ident">filter</span>: <span class="ident">ReviewFilterData</span> <span class="op">=</span> <span class="macro">unwrap!</span>(<span class="ident">serde_json::from_value</span>(<span class="ident">request_data</span>));
    <span class="kw">let</span> <span class="ident">response_data</span>  <span class="op">=</span> <span class="ident">get_some_data</span>(<span class="ident">filter</span>)<span class="question-mark">?</span>;
    <span class="kw">let</span> <span class="ident">response_html</span> <span class="op">=</span> <span class="ident"><span class="kw">crate</span>::auto_generated_files_mod::review_edit_html</span>();
    <span class="comment">// cln_methods::cln_review_edit(response_data, response_html)</span>
}</code></pre></div>
<p>Now run the automation task <code>cargo auto build</code> that generates auto_generated_mod.rs.</p>
<h4 id="client-module" class="section-header"><a href="#client-module">client module</a></h4>
<p>If I use a different struct for data, I must have different client modules and functions.<br />
With a generic data-struct all of this could be generic.</p>
<p>In <code>cln_methods_version_mod.rs</code> add a client function like this:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="attribute">#[<span class="ident">named</span>]</span>
<span class="kw">pub</span> <span class="kw">fn</span> <span class="ident">cln_review_edit</span>(<span class="ident">srv_response</span>: <span class="ident">RpcResponse</span>) {
    <span class="macro">log::info!</span>(<span class="string">&quot;{}&quot;</span>,<span class="macro">function_name!</span>());
    <span class="kw">let</span> <span class="ident">html</span> <span class="op">=</span> <span class="ident">extract_html</span>(<span class="kw-2">&amp;</span><span class="ident">srv_response</span>);
    <span class="ident">store_to_review_item_data</span>(<span class="ident">srv_response</span>);

    <span class="comment">// the mutex is locked inside a scope. When this structure falls out of scope, the lock will be unlocked.</span>
    <span class="kw">let</span> <span class="ident">html_after_process</span> <span class="op">=</span> {
        <span class="kw">let</span> <span class="ident">data</span> <span class="op">=</span> <span class="ident">REVIEW_ITEM_DATA</span>.<span class="ident">lock</span>().<span class="ident">unwrap</span>().<span class="ident">deref</span>();
        <span class="ident">process_html</span>(<span class="ident">data</span>, <span class="kw-2">&amp;</span><span class="ident">html</span>)
    };

    <span class="ident">inject_into_html</span>(<span class="kw-2">&amp;</span><span class="ident">html_after_process</span>);

    <span class="macro">on_click!</span>(<span class="string">&quot;button_review_save&quot;</span>, <span class="ident">request_review_save</span>);
    <span class="macro">on_click!</span>(<span class="string">&quot;button_review_list&quot;</span>, <span class="ident">request_review_list</span>);
}</code></pre></div>
<h3 id="sled-database" class="section-header"><a href="#sled-database">sled database</a></h3>
<p>I don’t want to repeatedly use crates.io api for the same data. I need a disk persistent storage for this data.<br />
I will have a try with the <a href="http://sled.rs/">sled</a> database. A lightweight pure-Rust high-performance transactional embedded database. This is a key-value database. The value can be any struct. There can be multiple separate trees/keyspaces: crates, versions, reviews, yanked,….</p>
<h3 id="plantuml" class="section-header"><a href="#plantuml">plantUml</a></h3>
<p>Write your diagrams in code with plantUml. The language syntax is pretty easy. I have a text file <code>images/server_plantuml_v3.txt</code>. The I use the online service <code>plantuml.com/plantuml/proxy</code> to create a png image. Because of caching I have the version of the file in the file name. When the version changes the old cache is not in use any more.<br />
The server modules:</p>
<p><a href="https://raw.githubusercontent.com/LucianoBestia/cargo_crev_reviews_workspace/main/images/server_plantuml_v3.txt"><img src="https://www.plantuml.com/plantuml/proxy?src=https://raw.githubusercontent.com/LucianoBestia/cargo_crev_reviews_workspace/main/images/server_plantuml_v3.txt" alt="plant_uml" /></a></p>
<h3 id="bad-surprise-on-wsl2" class="section-header"><a href="#bad-surprise-on-wsl2">Bad surprise on WSL2</a></h3>
<p>My git repository got corrupted. It looks that this happens to many people on WSL2.<br />
The cure is:</p>
<div class="example-wrap"><pre class="language-batch"><code>find .git/objects/ -type f -empty | xargs rm
git fetch -p
git fsck --full</code></pre></div><h3 id="some-other-info" class="section-header"><a href="#some-other-info">Some other info</a></h3>
<p>Cargo-crev knows also about Issues and Advisories. But for this project I focused only on Reviews. You can rate the version as Negative if there is something really broken with it.</p>
<h3 id="cargo-crev-reviews-and-advisory" class="section-header"><a href="#cargo-crev-reviews-and-advisory">cargo crev reviews and advisory</a></h3>
<p>We live in times of danger with <a href="https://en.wikipedia.org/wiki/Supply_chain_attack">supply chain attacks</a>.<br />
It is recommended to always use <a href="https://github.com/crev-dev/cargo-crev">cargo-crev</a><br />
to verify the trustworthiness of each of your dependencies.<br />
Please, spread this info.<br />
You can also read reviews quickly on the web:<br />
<a href="https://web.crev.dev/rust-reviews/crates/">https://web.crev.dev/rust-reviews/crates/</a></p>
<h3 id="open-source-free-and-free-as-a-beer" class="section-header"><a href="#open-source-free-and-free-as-a-beer">open-source free and free as a beer</a></h3>
<p>My open-source projects are free and free as a beer (MIT license).<br />
I just love programming.<br />
But I need also to drink. If you find my projects and tutorials helpful,<br />
please buy me a beer donating on my <a href="https://www.paypal.com/paypalme/LucianoBestia">paypal</a>.<br />
You know the price of a beer in your local bar ;-)<br />
So I can drink a free beer for your health :-)<br />
<a href="https://translate.google.com/?hl=en&amp;sl=sl&amp;tl=en&amp;text=Na%20zdravje&amp;op=translate">Na zdravje!</a> <a href="https://dictionary.cambridge.org/dictionary/italian-english/alla-salute">Alla salute!</a> <a href="https://dictionary.cambridge.org/dictionary/german-english/prost">Prost!</a> <a href="https://matadornetwork.com/nights/how-to-say-cheers-in-50-languages/">Nazdravlje!</a> 🍻</p>
</div></details><h2 id="modules" class="section-header"><a href="#modules">Modules</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="mod" href="auto_generated_files_mod/index.html" title="cargo_crev_reviews::auto_generated_files_mod mod">auto_generated_files_mod</a></div><div class="item-right docblock-short"><p>embedded files as Rust code</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="auto_generated_mod/index.html" title="cargo_crev_reviews::auto_generated_mod mod">auto_generated_mod</a></div><div class="item-right docblock-short"></div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="cargo_registry_mod/index.html" title="cargo_crev_reviews::cargo_registry_mod mod">cargo_registry_mod</a></div><div class="item-right docblock-short"><p>functions around the cargo registry<br />
~.cargo\registry\index\github.com-1ecc6299db9ec823\an\yh\anyhow<br />
~.cargo\registry\src\github.com-1ecc6299db9ec823\anyhow-1.0.37\  </p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="cargo_tree_mod/index.html" title="cargo_crev_reviews::cargo_tree_mod mod">cargo_tree_mod</a></div><div class="item-right docblock-short"></div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="common_structs_mod/index.html" title="cargo_crev_reviews::common_structs_mod mod">common_structs_mod</a></div><div class="item-right docblock-short"><p>common structs between the backend and frontend
One automation task will copy it over to cargo_crev_reviews_wasm/auto_generated_mod.rs !</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="crates_io_mod/index.html" title="cargo_crev_reviews::crates_io_mod mod">crates_io_mod</a></div><div class="item-right docblock-short"></div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="crev_mod/index.html" title="cargo_crev_reviews::crev_mod mod">crev_mod</a></div><div class="item-right docblock-short"><p>functions around the crev data and lib</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="db_sled_mod/index.html" title="cargo_crev_reviews::db_sled_mod mod">db_sled_mod</a></div><div class="item-right docblock-short"></div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="html_mod/index.html" title="cargo_crev_reviews::html_mod mod">html_mod</a></div><div class="item-right docblock-short"></div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="response_get_mod/index.html" title="cargo_crev_reviews::response_get_mod mod">response_get_mod</a></div><div class="item-right docblock-short"><p>response for the GET method. Mainly the static files, that are embedded in Rust code.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="response_post_mod/index.html" title="cargo_crev_reviews::response_post_mod mod">response_post_mod</a></div><div class="item-right docblock-short"><p>generic functions for response to the POST method</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="srv_methods_mod/index.html" title="cargo_crev_reviews::srv_methods_mod mod">srv_methods_mod</a></div><div class="item-right docblock-short"><p>rpc methods prepare the data to respond the POST rpc requests</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="stdio_input_password_mod/index.html" title="cargo_crev_reviews::stdio_input_password_mod mod">stdio_input_password_mod</a></div><div class="item-right docblock-short"><p>reads password from stdin</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="utils_mod/index.html" title="cargo_crev_reviews::utils_mod mod">utils_mod</a></div><div class="item-right docblock-short"></div></div></div><h2 id="structs" class="section-header"><a href="#structs">Structs</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.CLEAR_ALL.html" title="cargo_crev_reviews::CLEAR_ALL struct">CLEAR_ALL</a></div><div class="item-right docblock-short"><p>ansi clear all</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.CLEAR_LINE.html" title="cargo_crev_reviews::CLEAR_LINE struct">CLEAR_LINE</a></div><div class="item-right docblock-short"><p>ansi clear line</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.CREV_UNLOCKED.html" title="cargo_crev_reviews::CREV_UNLOCKED struct">CREV_UNLOCKED</a></div><div class="item-right docblock-short"><p>mutable static, because it is hard to pass variables around with async closures</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.GREEN.html" title="cargo_crev_reviews::GREEN struct">GREEN</a></div><div class="item-right docblock-short"><p>ansi color</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.LOCAL.html" title="cargo_crev_reviews::LOCAL struct">LOCAL</a></div><div class="item-right docblock-short"><p>crev_liv Local struct</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.RED.html" title="cargo_crev_reviews::RED struct">RED</a></div><div class="item-right docblock-short"><p>ansi color</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.RESET.html" title="cargo_crev_reviews::RESET struct">RESET</a></div><div class="item-right docblock-short"><p>ansi reset color</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.ResponseWithBytes.html" title="cargo_crev_reviews::ResponseWithBytes struct">ResponseWithBytes</a></div><div class="item-right docblock-short"></div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.SERVER_FIRST_SUBDIRECTORY.html" title="cargo_crev_reviews::SERVER_FIRST_SUBDIRECTORY struct">SERVER_FIRST_SUBDIRECTORY</a></div><div class="item-right docblock-short"></div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.SERVER_HOST.html" title="cargo_crev_reviews::SERVER_HOST struct">SERVER_HOST</a></div><div class="item-right docblock-short"><p>127.0.0.1</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.SERVER_PORT.html" title="cargo_crev_reviews::SERVER_PORT struct">SERVER_PORT</a></div><div class="item-right docblock-short"><p>8182</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.UNHIDE_CURSOR.html" title="cargo_crev_reviews::UNHIDE_CURSOR struct">UNHIDE_CURSOR</a></div><div class="item-right docblock-short"><p>ansi unhide cursor</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.YELLOW.html" title="cargo_crev_reviews::YELLOW struct">YELLOW</a></div><div class="item-right docblock-short"><p>ansi color</p>
</div></div></div><h2 id="enums" class="section-header"><a href="#enums">Enums</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.Status.html" title="cargo_crev_reviews::Status enum">Status</a></div><div class="item-right docblock-short"></div></div></div><h2 id="functions" class="section-header"><a href="#functions">Functions</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.cargo_crev_not_installed.html" title="cargo_crev_reviews::cargo_crev_not_installed fn">cargo_crev_not_installed</a></div><div class="item-right docblock-short"><p>warning cargo-crev not installed</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.host_port_is_busy.html" title="cargo_crev_reviews::host_port_is_busy fn">host_port_is_busy</a></div><div class="item-right docblock-short"><p>check that this is the only instance of this server
return None if the host+port is free
if the server host+port is not free, returns the String for the error message.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.not_started_inside_rust_project.html" title="cargo_crev_reviews::not_started_inside_rust_project fn">not_started_inside_rust_project</a></div><div class="item-right docblock-short"><p>warning not started in Rust project</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.one_instance_of_the_program_already_running.html" title="cargo_crev_reviews::one_instance_of_the_program_already_running fn">one_instance_of_the_program_already_running</a></div><div class="item-right docblock-short"><p>warning that one instance is already running</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.parse_get_uri_and_response_file.html" title="cargo_crev_reviews::parse_get_uri_and_response_file fn">parse_get_uri_and_response_file</a></div><div class="item-right docblock-short"><p>GET is used only to request files
Files are stored in functions in the auto_generated_files_mod.rs module
there is an automation task to copy files from web_server_folder to the module</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.parse_post_data_and_match_method.html" title="cargo_crev_reviews::parse_post_data_and_match_method fn">parse_post_data_and_match_method</a></div><div class="item-right docblock-short"></div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.response_404_not_found.html" title="cargo_crev_reviews::response_404_not_found fn">response_404_not_found</a></div><div class="item-right docblock-short"></div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.response_err_message.html" title="cargo_crev_reviews::response_err_message fn">response_err_message</a></div><div class="item-right docblock-short"></div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.response_modal_message.html" title="cargo_crev_reviews::response_modal_message fn">response_modal_message</a></div><div class="item-right docblock-short"></div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.sync_in_background_reviews.html" title="cargo_crev_reviews::sync_in_background_reviews fn">sync_in_background_reviews</a></div><div class="item-right docblock-short"><p>working with crev data looks slow.
I will sync in background with fast sled database and work from there.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.sync_in_background_verify.html" title="cargo_crev_reviews::sync_in_background_verify fn">sync_in_background_verify</a></div><div class="item-right docblock-short"><p>working with crev verify looks slow.
I will sync in background with fast sled database and work from there.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.sync_in_background_yanked.html" title="cargo_crev_reviews::sync_in_background_yanked fn">sync_in_background_yanked</a></div><div class="item-right docblock-short"><p>from cargo registry read all versions that are in db_version
only the yanked store in db_yanked</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.unlock_crev_id_interactively.html" title="cargo_crev_reviews::unlock_crev_id_interactively fn">unlock_crev_id_interactively</a></div><div class="item-right docblock-short"><p>unlock crev_id interactively</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.welcome_print.html" title="cargo_crev_reviews::welcome_print fn">welcome_print</a></div><div class="item-right docblock-short"><p>print the welcome text</p>
</div></div></div></section><section id="search" class="content hidden"></section><div id="rustdoc-vars" data-root-path="../" data-current-crate="cargo_crev_reviews" data-search-index-js="../search-index.js" data-search-js="../search.js"></div>
    <script src="../main.js"></script>
</body></html>